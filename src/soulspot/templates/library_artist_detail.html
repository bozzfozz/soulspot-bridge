{# Hey future me - Artist detail page!
   Shows artist avatar, album grid, and all tracks table.
   Tracks table has status badges and edit buttons. #}

{% extends "base.html" %}

{% block title %}{{ artist.name }} - Artists - SoulSpot{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav style="margin-bottom: var(--space-4);">
    <ol style="display: flex; align-items: center; gap: var(--space-2); font-size: var(--font-size-sm);">
        <li><a href="/ui/library" style="color: var(--accent-primary);">Library</a></li>
        <li style="color: var(--text-muted);"><i class="fa-solid fa-chevron-right" style="font-size: 0.6rem; margin: 0 var(--space-2);"></i></li>
        <li><a href="/ui/library/artists" style="color: var(--accent-primary);">Artists</a></li>
        <li style="color: var(--text-muted);"><i class="fa-solid fa-chevron-right" style="font-size: 0.6rem; margin: 0 var(--space-2);"></i>{{ artist.name }}</li>
    </ol>
</nav>

<!-- Artist Header -->
<div style="display: flex; align-items: center; gap: var(--space-6); margin-bottom: var(--space-8);">
    <div class="artist-avatar" style="width: 120px; height: 120px; background: linear-gradient(135deg, #a855f7, #7c3aed); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
        <span style="font-size: 3rem; font-weight: var(--font-weight-bold); color: white;">
            {{ artist.name[0]|upper }}
        </span>
    </div>
    <div>
        <h1 style="font-size: var(--font-size-3xl); margin-bottom: var(--space-2);">{{ artist.name }}</h1>
        <div style="display: flex; gap: var(--space-4); color: var(--text-muted); font-size: var(--font-size-sm);">
            <span><i class="fa-solid fa-compact-disc" style="margin-right: var(--space-2);"></i>{{ artist.albums|length }} album{{ 's' if artist.albums|length != 1 else '' }}</span>
            <span><i class="fa-solid fa-music" style="margin-right: var(--space-2);"></i>{{ artist.track_count }} track{{ 's' if artist.track_count != 1 else '' }}</span>
        </div>
    </div>
</div>

<!-- Albums Section -->
<div class="card" style="padding: var(--space-6); margin-bottom: var(--space-6);">
    <h2 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-bold); margin-bottom: var(--space-5);">Albums</h2>
    {% if artist.albums %}
    <div class="albums-grid">
        {% for album in artist.albums %}
        <a href="/ui/library/albums/{{ album.id }}" class="album-card">
            <div class="album-cover">
                <i class="fa-solid fa-compact-disc"></i>
            </div>
            <h3 class="album-title" title="{{ album.title }}">{{ album.title }}</h3>
            <div class="album-meta">
                <span>{{ album.track_count }} tracks</span>
                {% if album.year %}<span>{{ album.year }}</span>{% endif %}
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state-small">
        <i class="fa-solid fa-compact-disc"></i>
        <p>No albums found for this artist.</p>
    </div>
    {% endif %}
</div>

<!-- All Tracks Section -->
<div class="card" style="padding: 0; overflow: hidden;">
    <div style="padding: var(--space-5) var(--space-6); border-bottom: 1px solid var(--border-primary);">
        <h2 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-bold);">All Tracks</h2>
    </div>
    {% if artist.tracks %}
    <div style="overflow-x: auto;">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Album</th>
                    <th>Duration</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for track in artist.tracks %}
                <tr>
                    <td><span style="font-weight: var(--font-weight-medium);">{{ track.title }}</span></td>
                    <td style="color: var(--text-muted);">{{ track.album or "Unknown Album" }}</td>
                    <td style="color: var(--text-muted);">
                        {% if track.duration_ms %}
                            {% set minutes = (track.duration_ms / 60000) | int %}
                            {% set seconds = ((track.duration_ms % 60000) / 1000) | int %}
                            {{ "%d:%02d" | format(minutes, seconds) }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if track.is_broken %}
                            <span class="badge badge-error">Broken</span>
                        {% elif track.file_path %}
                            <span class="badge badge-success">Downloaded</span>
                        {% else %}
                            <span class="badge badge-warning">Missing</span>
                        {% endif %}
                    </td>
                    <td>
                        <button class="btn btn-sm btn-ghost"
                                hx-get="/tracks/{{ track.id }}/metadata-editor"
                                hx-target="#metadata-modal"
                                hx-swap="innerHTML">
                            Edit
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state-small" style="padding: var(--space-8);">
        <i class="fa-solid fa-music"></i>
        <p>No tracks found for this artist.</p>
    </div>
    {% endif %}
</div>

<!-- Metadata Modal Container -->
<div id="metadata-modal"></div>
{% endblock %}

{% block extra_scripts %}
<style>
    .albums-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: var(--space-4);
    }
    .album-card {
        background: var(--bg-tertiary);
        border-radius: var(--radius-lg);
        padding: var(--space-4);
        text-decoration: none;
        color: var(--text-primary);
        transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    }
    .album-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }
    .album-cover {
        aspect-ratio: 1;
        background: linear-gradient(135deg, #22c55e, #16a34a);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-3);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        color: rgba(255, 255, 255, 0.4);
    }
    .album-title {
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-semibold);
        margin-bottom: var(--space-1);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .album-meta {
        display: flex;
        justify-content: space-between;
        font-size: var(--font-size-xs);
        color: var(--text-muted);
    }
    .data-table {
        width: 100%;
        border-collapse: collapse;
    }
    .data-table th {
        padding: var(--space-3) var(--space-4);
        text-align: left;
        font-size: var(--font-size-xs);
        font-weight: var(--font-weight-medium);
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        background: var(--bg-tertiary);
    }
    .data-table td {
        padding: var(--space-3) var(--space-4);
        border-bottom: 1px solid var(--border-primary);
        font-size: var(--font-size-sm);
    }
    .data-table tr:hover {
        background: var(--bg-hover);
    }
    .empty-state-small {
        text-align: center;
        padding: var(--space-6);
        color: var(--text-muted);
    }
    .empty-state-small i {
        font-size: var(--font-size-3xl);
        margin-bottom: var(--space-3);
        display: block;
        opacity: 0.5;
    }
</style>
{% endblock %}
