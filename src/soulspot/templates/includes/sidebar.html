{# Hey future me - this is the sidebar navigation for the new UI. Uses request.url.path for active state highlighting.
   The queue_count variable should be passed from the router for badge display. The user variable is for avatar display.
   Keep this in sync with the routes in ui.py - if you add a new page, add a sidebar link here!
   
   STRUKTUR-KONZEPT (Nov 2025):
   - Main: Dashboard, Search (globale Einstiegspunkte)
   - Spotify: Alles was von Spotify kommt (online, cloud)
   - Local Library: Alles was heruntergeladen/lokal ist
   - Downloads: Queue, aktive Transfers
   - System: Settings, Dev-Tools
   
   ICONS: Bootstrap Icons (bi-*) - https://icons.getbootstrap.com/
#}

<!-- Sidebar -->
<aside class="app-sidebar" id="sidebar">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
        <a href="/" class="sidebar-logo">
            <i class="bi bi-music-note-beamed sidebar-logo-icon"></i>
            <span class="sidebar-logo-text">SoulSpot</span>
        </a>
    </div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar-nav">
        <!-- Main Section -->
        <div class="sidebar-section">
            <div class="sidebar-section-title">Main</div>
            <a href="/" class="sidebar-item {% if request.url.path == '/' or request.url.path == '/dashboard' %}active{% endif %}">
                <i class="bi bi-house sidebar-item-icon"></i>
                <span class="sidebar-item-text">Dashboard</span>
            </a>
            <a href="/search" class="sidebar-item {% if request.url.path == '/search' %}active{% endif %}">
                <i class="bi bi-search sidebar-item-icon"></i>
                <span class="sidebar-item-text">Search</span>
            </a>
        </div>

        <!-- Spotify Section (Online/Cloud) -->
        <div class="sidebar-section">
            <div class="sidebar-section-title">
                <i class="bi bi-spotify" style="color: #1DB954; margin-right: 6px;"></i>Spotify
            </div>
            <a href="/playlists" class="sidebar-item {% if '/playlists' in request.url.path and '/import' not in request.url.path %}active{% endif %}">
                <i class="bi bi-list-ul sidebar-item-icon"></i>
                <span class="sidebar-item-text">Playlists</span>
            </a>
            <a href="/spotify/artists" class="sidebar-item {% if '/spotify/artists' in request.url.path %}active{% endif %}">
                <i class="bi bi-heart sidebar-item-icon"></i>
                <span class="sidebar-item-text">Followed Artists</span>
            </a>
            <a href="/playlists/import" class="sidebar-item {% if '/playlists/import' in request.url.path %}active{% endif %}">
                <i class="bi bi-cloud-arrow-down sidebar-item-icon"></i>
                <span class="sidebar-item-text">Import</span>
            </a>
        </div>

        <!-- Local Library Section -->
        <div class="sidebar-section">
            <div class="sidebar-section-title">
                <i class="bi bi-folder2-open" style="color: var(--accent-primary); margin-right: 6px;"></i>Library
            </div>
            <a href="/library/import" class="sidebar-item {% if '/library/import' in request.url.path %}active{% endif %}">
                <i class="bi bi-upload sidebar-item-icon"></i>
                <span class="sidebar-item-text">Import</span>
            </a>
            <a href="/library/artists" class="sidebar-item {% if '/library/artists' in request.url.path and '/import' not in request.url.path %}active{% endif %}">
                <i class="bi bi-person sidebar-item-icon"></i>
                <span class="sidebar-item-text">Artists</span>
            </a>
            <a href="/library/albums" class="sidebar-item {% if '/library/albums' in request.url.path %}active{% endif %}">
                <i class="bi bi-disc sidebar-item-icon"></i>
                <span class="sidebar-item-text">Albums</span>
            </a>
            <a href="/library/tracks" class="sidebar-item {% if '/library/tracks' in request.url.path %}active{% endif %}">
                <i class="bi bi-music-note sidebar-item-icon"></i>
                <span class="sidebar-item-text">Tracks</span>
            </a>
        </div>

        <!-- Downloads Section -->
        <div class="sidebar-section">
            <div class="sidebar-section-title">Downloads</div>
            <a href="/downloads" class="sidebar-item {% if '/downloads' in request.url.path %}active{% endif %}">
                <i class="bi bi-clock-history sidebar-item-icon"></i>
                <span class="sidebar-item-text">Queue</span>
                {% if queue_count is defined and queue_count and queue_count > 0 %}
                <span class="sidebar-item-badge">{{ queue_count }}</span>
                {% endif %}
            </a>
        </div>

        <!-- System Section -->
        <div class="sidebar-section">
            <div class="sidebar-section-title">System</div>
            <a href="/settings" class="sidebar-item {% if '/settings' in request.url.path %}active{% endif %}">
                <i class="bi bi-gear sidebar-item-icon"></i>
                <span class="sidebar-item-text">Settings</span>
            </a>
            <a href="/styleguide" class="sidebar-item {% if '/styleguide' in request.url.path %}active{% endif %}">
                <i class="bi bi-palette sidebar-item-icon"></i>
                <span class="sidebar-item-text">Styleguide</span>
            </a>
        </div>
    </nav>

    <!-- Sidebar Footer: Worker Status Indicator -->
    {# Hey future me - dieser Footer zeigt den Status der Background-Worker!
       Ein einzelnes Spotify-Icon zeigt den kombinierten Status aller Worker.
       Bei Hover erscheint ein Tooltip mit Details (letzter Sync, etc).
       Klick navigiert zu den Settings.
       
       Animation:
       - Idle: sanftes Pulsieren (grün)
       - Active/Syncing: drehendes Icon
       - Error: rotes Icon mit Pulsieren
       
       Auf Mobile: Touch auf Container öffnet Tooltip (via :focus-within)
    #}
    <div class="sidebar-footer">
        <div class="worker-status"
             hx-get="/api/workers/status/html"
             hx-trigger="load, every 10s"
             hx-swap="innerHTML">
            <!-- Fallback bis HTMX lädt -->
            <div class="worker-indicator-single" tabindex="0">
                <a href="/settings?tab=spotify" class="worker-icon" data-status="idle" aria-label="Background Workers Status">
                    <i class="bi bi-disc"></i>
                </a>
            </div>
        </div>
    </div>
</aside>
