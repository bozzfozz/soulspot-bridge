{# Widget Canvas Partial - Renders all widgets on a page #}
{% if widgets and widgets|length > 0 %}
  {% for item in widgets %}
    {% set instance = item.instance %}
    {% set widget = item.widget %}
    
    <div class="widget-card widget-col-{{ instance.span_cols }}" 
         id="widget-instance-{{ instance.id }}"
         data-widget-id="{{ instance.id }}"
         data-widget-type="{{ instance.widget_type }}">
      
      {# Widget Controls (only in edit mode) #}
      {% if edit_mode %}
        <div class="widget-controls">
          <button hx-post="/api/ui/widgets/instances/{{ instance.id }}/move-up"
                  hx-target="#widget-canvas"
                  hx-swap="innerHTML"
                  aria-label="Move up"
                  title="Move up">
            ↑
          </button>
          <button hx-post="/api/ui/widgets/instances/{{ instance.id }}/move-down"
                  hx-target="#widget-canvas"
                  hx-swap="innerHTML"
                  aria-label="Move down"
                  title="Move down">
            ↓
          </button>
          <button hx-post="/api/ui/widgets/instances/{{ instance.id }}/move-left"
                  hx-target="#widget-canvas"
                  hx-swap="innerHTML"
                  aria-label="Move left"
                  title="Move left">
            ←
          </button>
          <button hx-post="/api/ui/widgets/instances/{{ instance.id }}/move-right"
                  hx-target="#widget-canvas"
                  hx-swap="innerHTML"
                  aria-label="Move right"
                  title="Move right">
            →
          </button>
          <button hx-post="/api/ui/widgets/instances/{{ instance.id }}/resize"
                  hx-target="#widget-canvas"
                  hx-swap="innerHTML"
                  aria-label="Resize"
                  title="Toggle size (4/6/12 columns)">
            ⬌
          </button>
          <button hx-get="/api/ui/widgets/instances/{{ instance.id }}/config"
                  hx-target="#modal-container"
                  hx-swap="innerHTML"
                  aria-label="Configure"
                  title="Configure widget">
            ⚙
          </button>
          <button class="btn-danger"
                  hx-delete="/api/ui/widgets/instances/{{ instance.id }}"
                  hx-confirm="Remove this widget?"
                  hx-target="#widget-instance-{{ instance.id }}"
                  hx-swap="outerHTML swap:300ms"
                  aria-label="Remove"
                  title="Remove widget">
            ✕
          </button>
        </div>
      {% endif %}
      
      {# Widget Content - Include the specific widget template #}
      {% include widget.template_path with context %}
    </div>
  {% endfor %}
{% else %}
  {# Empty state #}
  <div class="widget-col-12 text-center py-16">
    <svg class="mx-auto h-16 w-16 text-gray-400 dark:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
    </svg>
    <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">No widgets yet</h3>
    <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
      {% if edit_mode %}
        Click "Add Widget" to start customizing your dashboard
      {% else %}
        Click "Edit Dashboard" to add widgets
      {% endif %}
    </p>
  </div>
{% endif %}
