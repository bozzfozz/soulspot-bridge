{# Metadata Manager Widget - Shows metadata issues and quick fixes #}
<div class="widget-content">
  <div class="widget-header">
    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Metadata Manager</h3>
    <span class="text-sm text-gray-500 dark:text-gray-400">{{ issues_count|default(0) }} issues</span>
  </div>
  
  <div class="widget-body mt-4">
    <div class="flex gap-2 mb-4">
      <button class="filter-btn text-xs px-3 py-1 rounded transition-colors
                     {% if filter == 'all' or not filter %}
                       bg-blue-500 text-white
                     {% else %}
                       bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600
                     {% endif %}"
              hx-get="/api/ui/widgets/metadata-manager/content?filter=all"
              hx-target="closest .widget-content"
              hx-swap="innerHTML">
        All
      </button>
      <button class="filter-btn text-xs px-3 py-1 rounded transition-colors
                     {% if filter == 'missing' %}
                       bg-blue-500 text-white
                     {% else %}
                       bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600
                     {% endif %}"
              hx-get="/api/ui/widgets/metadata-manager/content?filter=missing"
              hx-target="closest .widget-content"
              hx-swap="innerHTML">
        Missing
      </button>
      <button class="filter-btn text-xs px-3 py-1 rounded transition-colors
                     {% if filter == 'incorrect' %}
                       bg-blue-500 text-white
                     {% else %}
                       bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600
                     {% endif %}"
              hx-get="/api/ui/widgets/metadata-manager/content?filter=incorrect"
              hx-target="closest .widget-content"
              hx-swap="innerHTML">
        Incorrect
      </button>
    </div>
    
    {% if issues and issues|length > 0 %}
      <div class="space-y-2">
        {% for issue in issues[:5] %}
          <div class="issue-item p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
            <div class="flex items-start justify-between">
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-gray-900 dark:text-white truncate">
                  {{ issue.track_title|default('Unknown Track') }}
                </p>
                <p class="text-xs text-gray-500 dark:text-gray-400 truncate">
                  {{ issue.track_artist|default('Unknown Artist') }}
                </p>
                <div class="flex items-center gap-2 mt-1">
                  <span class="text-xs px-2 py-0.5 rounded
                               {% if issue.severity == 'high' %}bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300
                               {% elif issue.severity == 'medium' %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300
                               {% else %}bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300
                               {% endif %}">
                    {{ issue.issue_type|title }}
                  </span>
                  <span class="text-xs text-gray-500 dark:text-gray-400">
                    {{ issue.description }}
                  </span>
                </div>
              </div>
              
              {% if issue.can_auto_fix %}
                <button class="ml-2 text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 whitespace-nowrap"
                        hx-post="/api/metadata/{{ issue.track_id }}/auto-fix"
                        hx-target="closest .issue-item"
                        hx-swap="outerHTML swap:300ms">
                  Quick Fix
                </button>
              {% else %}
                <button class="ml-2 text-xs px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-600 whitespace-nowrap"
                        hx-get="/api/ui/metadata/{{ issue.track_id }}/edit"
                        hx-target="#modal-container"
                        hx-swap="innerHTML">
                  Edit
                </button>
              {% endif %}
            </div>
          </div>
        {% endfor %}
        
        {% if issues|length > 5 %}
          <a href="/ui/metadata?filter={{ filter|default('all') }}" 
             class="block text-center text-sm text-blue-600 dark:text-blue-400 hover:underline mt-2">
            View all {{ issues|length }} issues â†’
          </a>
        {% endif %}
        
        {% if issues|selectattr('can_auto_fix')|list|length > 0 %}
          <button class="w-full mt-3 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-medium text-sm"
                  hx-post="/api/metadata/auto-fix-all"
                  hx-confirm="Auto-fix all fixable metadata issues?"
                  hx-target="closest .widget-content"
                  hx-swap="innerHTML">
            Auto-Fix All ({{ issues|selectattr('can_auto_fix')|list|length }})
          </button>
        {% endif %}
      </div>
    {% else %}
      <div class="text-center py-8 text-gray-500 dark:text-gray-400">
        <svg class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <p class="mt-2 text-sm">No metadata issues found!</p>
        <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">All tracks have clean metadata</p>
      </div>
    {% endif %}
  </div>
</div>
