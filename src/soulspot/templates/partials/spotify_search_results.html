{# 
  Hey future me - Spotify Search Results Partial (HTMX loaded)
  
  This is what gets loaded into the search results container when searching Spotify.
  Each result is a compact track item with download button. Uses new design system styling.
  The download button triggers HTMX post and swaps the item to show "Added" state.
#}
{% if results and results|length > 0 %}
  <div style="display: flex; flex-direction: column; gap: var(--space-2);">
    {% for track in results %}
      <div class="result-item" style="padding: var(--space-3); background: var(--bg-secondary); border-radius: var(--radius-lg); transition: background 0.2s;">
        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: var(--space-3);">
          <div style="flex: 1; min-width: 0;">
            <p style="font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
              {{ track.name }}
            </p>
            <p style="font-size: var(--font-size-xs); color: var(--text-muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
              {{ track.artists|join(', ') }}
            </p>
            {% if track.album %}
              <p style="font-size: var(--font-size-xs); color: var(--text-muted); opacity: 0.7; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                {{ track.album }}
              </p>
            {% endif %}
          </div>
          
          <button class="btn btn-primary btn-sm"
                  style="white-space: nowrap;"
                  hx-post="/api/downloads"
                  hx-vals='{"spotify_uri": "{{ track.uri }}", "title": "{{ track.name }}", "artist": "{{ track.artists[0] }}"}'
                  hx-target="closest .result-item"
                  hx-swap="innerHTML"
                  hx-indicator="#download-{{ loop.index }}">
            <span id="download-{{ loop.index }}" class="htmx-indicator">
              <i class="bi bi-arrow-repeat bi-spin"></i>
            </span>
            <span class="htmx-indicator-off">
              <i class="bi bi-download"></i> Download
            </span>
          </button>
        </div>
        
        {% if track.duration_ms %}
          <div style="display: flex; align-items: center; gap: var(--space-2); margin-top: var(--space-1);">
            <i class="bi bi-clock" style="font-size: var(--font-size-xs); color: var(--text-muted);"></i>
            <span style="font-size: var(--font-size-xs); color: var(--text-muted);">
              {{ (track.duration_ms / 60000)|round(0, 'floor') }}:{{ '%02d'|format((track.duration_ms / 1000)|int % 60) }}
            </span>
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% elif query %}
  <div style="text-align: center; padding: var(--space-8); color: var(--text-muted);">
    <i class="bi bi-emoji-neutral" style="font-size: 48px; color: var(--text-muted); margin-bottom: var(--space-4); display: block;"></i>
    <p style="font-size: var(--font-size-sm); margin-bottom: var(--space-1);">No results found for "{{ query }}"</p>
    <p style="font-size: var(--font-size-xs); opacity: 0.7;">Try a different search term</p>
  </div>
{% else %}
  <div style="text-align: center; padding: var(--space-8); color: var(--text-muted); font-size: var(--font-size-sm);">
    <i class="bi bi-search" style="font-size: 32px; margin-bottom: var(--space-3); display: block; opacity: 0.5;"></i>
    Start typing to search...
  </div>
{% endif %}
