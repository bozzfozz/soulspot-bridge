{# 
  Hey future me - Followed Artists List Partial (HTMX loaded after Spotify sync)
  
  This renders the artist grid after syncing from Spotify. Each artist card has a checkbox
  for selection to create watchlists. Uses new design system with media cards styling.
  The handleImageError creates a DOM-based fallback (no innerHTML XSS risk).
#}
{% if artists %}
    {% for artist in artists %}
    <div class="media-card" style="cursor: pointer;">
        <label style="cursor: pointer; display: block;">
            <div style="padding: var(--space-4);">
                <div style="display: flex; align-items: flex-start; gap: var(--space-3);">
                    <input type="checkbox" 
                           class="artist-checkbox"
                           style="margin-top: var(--space-1); width: 20px; height: 20px; accent-color: var(--accent-primary);"
                           data-artist-id="{{ artist.id }}"
                           onchange="toggleArtist('{{ artist.id }}')">
                    
                    <div class="artist-image-wrapper">
                        {% if artist.image_url %}
                            <img src="{{ artist.image_url }}" 
                                 alt="{{ artist.name }}" 
                                 loading="lazy"
                                 onerror="handleImageError(this)"
                                 style="width: 64px; height: 64px; border-radius: var(--radius-lg); object-fit: cover; flex-shrink: 0; box-shadow: var(--shadow-md);">
                        {% else %}
                            <div style="width: 64px; height: 64px; border-radius: var(--radius-lg); background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: var(--shadow-md);">
                                <i class="bi bi-music-note" style="font-size: 24px; color: white;"></i>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div style="flex: 1; min-width: 0;">
                        <h3 style="font-weight: var(--font-weight-semibold); color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ artist.name }}">
                            {{ artist.name }}
                        </h3>
                        {% if artist.genres and artist.genres|length > 0 %}
                            <div style="display: flex; flex-wrap: wrap; gap: var(--space-1); margin-top: var(--space-2);">
                                {% for genre in artist.genres[:3] %}
                                    <span class="badge badge-default" style="font-size: var(--font-size-xs);">{{ genre }}</span>
                                {% endfor %}
                                {% if artist.genres|length > 3 %}
                                    <span style="font-size: var(--font-size-xs); color: var(--text-muted);">+{{ artist.genres|length - 3 }} more</span>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </label>
    </div>
    {% endfor %}

    <script>
        // Hey future me - handleImageError safely replaces broken images with fallback placeholder!
        // Uses DOM methods instead of innerHTML to prevent XSS vulnerabilities.
        function handleImageError(img) {
            img.onerror = null;
            
            const placeholder = document.createElement('div');
            placeholder.style.cssText = 'width: 64px; height: 64px; border-radius: var(--radius-lg); background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: var(--shadow-md);';
            
            const icon = document.createElement('i');
            icon.className = 'bi bi-music-note';
            icon.style.cssText = 'font-size: 24px; color: white;';
            
            placeholder.appendChild(icon);
            img.parentNode.replaceChild(placeholder, img);
        }
        
        // Update stats after artists are rendered
        window.syncStats = {
            total_fetched: {{ total_fetched }},
            created: {{ created }},
            updated: {{ updated }},
            errors: {{ errors }}
        };
        
        if (window.updateStatsFromPartial) {
            window.updateStatsFromPartial();
        }

        const btn = document.getElementById('create-watchlists-btn');
        if (btn) btn.disabled = false;
    </script>
{% else %}
    <div style="grid-column: 1 / -1; text-align: center; padding: var(--space-12);">
        <i class="bi bi-inbox" style="font-size: 48px; color: var(--text-muted); margin-bottom: var(--space-4); display: block;"></i>
        <p style="color: var(--text-muted);">No followed artists found</p>
    </div>
{% endif %}
