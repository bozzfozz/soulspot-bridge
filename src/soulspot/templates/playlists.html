{# Hey future me - Playlists overview page!
   Shows all imported playlists in a grid.
   Media cards have hover actions for play/download.
   Pagination at bottom if total_pages > 1. #}

{% extends "base.html" %}

{% block title %}Playlists - SoulSpot{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="flex items-center justify-between mb-8">
    <div>
        <h1>Playlists</h1>
        <p class="text-muted" style="margin-top: 0.5rem;">Manage your Spotify playlists</p>
    </div>
    <div class="flex gap-3">
        <button class="btn btn-outline" hx-post="/api/playlists/sync-all" hx-swap="none">
            <i class="bi bi-arrow-clockwise"></i>
            Sync All
        </button>
        <a href="/playlists/import" class="btn btn-primary">
            <i class="bi bi-plus-lg"></i>
            Import Playlist
        </a>
    </div>
</div>

<!-- Stats -->
<div class="grid grid-cols-4 mb-8">
    <div class="stat-card">
        <div class="stat-card-icon">
            <i class="bi bi-list-ul"></i>
        </div>
        <div class="stat-card-content">
            <div class="stat-card-label">Total Playlists</div>
            <div class="stat-card-value">{{ playlists|length if playlists else 0 }}</div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-card-icon">
            <i class="bi bi-music-note"></i>
        </div>
        <div class="stat-card-content">
            <div class="stat-card-label">Total Tracks</div>
            <div class="stat-card-value">{{ total_tracks|default(0) }}</div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-card-icon">
            <i class="bi bi-check-circle"></i>
        </div>
        <div class="stat-card-content">
            <div class="stat-card-label">Downloaded</div>
            <div class="stat-card-value">{{ downloaded_tracks|default(0) }}</div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-card-icon">
            <i class="bi bi-clock"></i>
        </div>
        <div class="stat-card-content">
            <div class="stat-card-label">Pending</div>
            <div class="stat-card-value">{{ pending_tracks|default(0) }}</div>
        </div>
    </div>
</div>

<!-- Playlists Grid -->
{% if playlists %}
<div class="grid grid-cols-5">
    {% for playlist in playlists %}
    <a href="/playlists/{{ playlist.id }}" class="media-card">
        <div class="media-card-image">
            <img src="{{ playlist.cover_url or 'https://via.placeholder.com/300x300?text=' + (playlist.name[:1] if playlist.name else 'P') }}"
                alt="{{ playlist.name }}">
            <div class="media-card-overlay">
                <div class="media-card-actions">
                    <button class="btn-icon btn-primary"
                        onclick="event.preventDefault(); playPlaylist('{{ playlist.id }}')">
                        <i class="bi bi-play-fill"></i>
                    </button>
                    <button class="btn-icon" onclick="event.preventDefault(); downloadPlaylist('{{ playlist.id }}')">
                        <i class="bi bi-download"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="media-card-content">
            <div class="media-card-title">{{ playlist.name }}</div>
            <div class="media-card-subtitle">{{ playlist.track_count|default(0) }} tracks</div>
            <div class="media-card-meta">
                {% if playlist.downloaded_count %}
                <span class="badge badge-success">
                    {{ playlist.downloaded_count }} downloaded
                </span>
                {% endif %}
                {% if playlist.pending_count %}
                <span class="badge badge-warning">
                    {{ playlist.pending_count }} pending
                </span>
                {% endif %}
            </div>
        </div>
    </a>
    {% endfor %}
</div>

<!-- Pagination -->
{% if total_pages is defined and total_pages > 1 %}
<div class="flex items-center justify-center gap-2" style="margin-top: 2rem;">
    {% if page > 1 %}
    <a href="?page={{ page - 1 }}" class="btn btn-outline btn-sm">
        <i class="bi bi-chevron-left"></i>
    </a>
    {% endif %}
    <span class="text-muted">Page {{ page }} of {{ total_pages }}</span>
    {% if page < total_pages %}
    <a href="?page={{ page + 1 }}" class="btn btn-outline btn-sm">
        <i class="bi bi-chevron-right"></i>
    </a>
    {% endif %}
</div>
{% endif %}

{% else %}
<!-- Empty State -->
<div class="card" style="text-align: center; padding: 4rem;">
    <i class="bi bi-list-ul" style="font-size: 4rem; color: var(--text-muted); margin-bottom: 1.5rem;"></i>
    <h2>No Playlists Yet</h2>
    <p class="text-muted" style="margin-top: 0.5rem; margin-bottom: 2rem;">
        Import your first playlist from Spotify to get started.
    </p>
    <a href="/playlists/import" class="btn btn-primary">
        <i class="bi bi-plus-lg"></i>
        Import from Spotify
    </a>
</div>
{% endif %}
{% endblock %}

{% block extra_scripts %}
<script>
    function playPlaylist(playlistId) {
        console.log('Playing playlist:', playlistId);
    }

    function downloadPlaylist(playlistId) {
        htmx.ajax('POST', '/api/playlists/' + playlistId + '/download', {
            target: 'body',
            swap: 'none'
        });
        SoulSpot.showNotification('Playlist added to download queue', 'success');
    }
</script>
{% endblock %}