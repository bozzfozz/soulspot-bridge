{# Hey future me - Albums browse page!
   Shows all albums as cards with Spotify artwork (or placeholder), artist name, track count, year.
   artwork_url comes from Spotify CDN via album.artwork_url. Fallback to bi-disc icon if no artwork.
   Client-side search AND sorting via data attributes on cards. Works together so you can search THEN sort. #}

{% extends "base.html" %}

{% block title %}Albums - SoulSpot{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav style="margin-bottom: var(--space-4);">
    <ol style="display: flex; align-items: center; gap: var(--space-2); font-size: var(--font-size-sm);">
        <li><a href="/ui/library" style="color: var(--accent-primary);">Library</a></li>
        <li style="color: var(--text-muted);"><i class="bi bi-chevron-right" style="font-size: 0.6rem; margin: 0 var(--space-2);"></i>Albums</li>
    </ol>
</nav>

<!-- Page Header -->
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-6); flex-wrap: wrap; gap: var(--space-4);">
    <div style="display: flex; align-items: center; gap: var(--space-4);">
        <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #22c55e, #16a34a); border-radius: var(--radius-xl); display: flex; align-items: center; justify-content: center;">
            <i class="bi bi-disc" style="color: white; font-size: 1.25rem;"></i>
        </div>
        <div>
            <h1 style="font-size: var(--font-size-3xl); margin-bottom: var(--space-1);">Albums</h1>
            <p style="color: var(--text-muted); font-size: var(--font-size-sm);">Browse {{ albums|length }} albums in your library</p>
        </div>
    </div>
    <div style="display: flex; flex-wrap: wrap; gap: var(--space-3);">
        <input type="text" 
               id="album-search"
               placeholder="Search albums..."
               class="form-input"
               style="min-width: 180px;">
        <select id="sort-filter" class="form-select" style="min-width: 150px;">
            <option value="artist-asc">Artist (A-Z)</option>
            <option value="artist-desc">Artist (Z-A)</option>
            <option value="title-asc">Title (A-Z)</option>
            <option value="title-desc">Title (Z-A)</option>
            <option value="year-desc">Year (Newest)</option>
            <option value="year-asc">Year (Oldest)</option>
            <option value="tracks-desc">Most Tracks</option>
            <option value="tracks-asc">Fewest Tracks</option>
        </select>
    </div>
</div>

<!-- Albums Grid -->
<div id="albums-list">
    {% if albums %}
    <div class="albums-grid">
        {% for album in albums %}
        <a href="/ui/library/albums/{{ album.artist|urlencode }}::{{ album.title|urlencode }}" 
           class="album-card"
           data-title="{{ album.title|lower }}"
           data-artist="{{ album.artist|lower }}"
           data-year="{{ album.year or 0 }}"
           data-track-count="{{ album.track_count }}">
            <div class="album-cover">
                {% if album.artwork_url %}
                <img src="{{ album.artwork_url }}" alt="{{ album.title }}" loading="lazy">
                {% else %}
                <i class="bi bi-disc"></i>
                {% endif %}
            </div>
            <h3 class="album-title" title="{{ album.title }}">{{ album.title }}</h3>
            <p class="album-artist" title="{{ album.artist }}">{{ album.artist }}</p>
            <div class="album-meta">
                <span><i class="bi bi-music-note"></i> {{ album.track_count }}</span>
                {% if album.year %}
                <span>{{ album.year }}</span>
                {% endif %}
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon" style="background: rgba(34, 197, 94, 0.1);">
            <i class="bi bi-disc" style="color: #22c55e;"></i>
        </div>
        <h3>No albums found</h3>
        <p>Your library does not contain any albums yet. Import some playlists to get started!</p>
        <a href="/ui/playlists/import" class="btn btn-primary">
            <i class="bi bi-plus-lg"></i>
            Import Playlist
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<style>
    .albums-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: var(--space-4);
    }
    .album-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-lg);
        padding: var(--space-4);
        text-decoration: none;
        color: var(--text-primary);
        transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    }
    .album-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-xl);
    }
    .album-cover {
        aspect-ratio: 1;
        background: linear-gradient(135deg, #22c55e, #16a34a);
        border-radius: var(--radius-lg);
        margin-bottom: var(--space-3);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: rgba(255, 255, 255, 0.4);
        transition: transform var(--transition-fast);
        overflow: hidden;
    }
    .album-cover img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .album-card:hover .album-cover {
        transform: scale(1.02);
    }
    .album-title {
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-bold);
        margin-bottom: var(--space-1);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .album-card:hover .album-title {
        color: var(--accent-primary);
    }
    .album-artist {
        font-size: var(--font-size-xs);
        color: var(--text-muted);
        margin-bottom: var(--space-2);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .album-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: var(--font-size-xs);
        color: var(--text-muted);
    }
    .album-meta i {
        margin-right: var(--space-1);
    }
    .empty-state {
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-xl);
        padding: var(--space-12);
        text-align: center;
    }
    .empty-icon {
        width: 96px;
        height: 96px;
        margin: 0 auto var(--space-6);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
    }
    .empty-state h3 {
        font-size: var(--font-size-2xl);
        font-weight: var(--font-weight-bold);
        margin-bottom: var(--space-3);
    }
    .empty-state p {
        color: var(--text-muted);
        margin-bottom: var(--space-6);
    }
</style>
<script>
// Hey future me - this handles client-side search AND sorting for albums.
// Search filters by title/artist, sort reorders the grid dynamically.
// Both work together so you can search THEN sort the results.
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('album-search');
    const sortFilter = document.getElementById('sort-filter');
    const albumsGrid = document.querySelector('.albums-grid');
    
    function getSortValue(card, field) {
        switch(field) {
            case 'title': return card.getAttribute('data-title') || '';
            case 'artist': return card.getAttribute('data-artist') || '';
            case 'year': return parseInt(card.getAttribute('data-year')) || 0;
            case 'tracks': return parseInt(card.getAttribute('data-track-count')) || 0;
            default: return card.getAttribute('data-title') || '';
        }
    }
    
    function filterAndSortAlbums() {
        if (!albumsGrid) return;
        
        const searchTerm = (searchInput?.value || '').toLowerCase();
        const sortValue = sortFilter?.value || 'artist-asc';
        const [sortField, sortDir] = sortValue.split('-');
        const albumCards = Array.from(document.querySelectorAll('.album-card'));
        
        // Filter by search term
        albumCards.forEach(card => {
            const title = card.getAttribute('data-title') || '';
            const artist = card.getAttribute('data-artist') || '';
            card.style.display = (title.includes(searchTerm) || artist.includes(searchTerm)) ? '' : 'none';
        });
        
        // Sort visible cards
        const visibleCards = albumCards.filter(c => c.style.display !== 'none');
        visibleCards.sort((a, b) => {
            const aVal = getSortValue(a, sortField);
            const bVal = getSortValue(b, sortField);
            
            if (typeof aVal === 'number' && typeof bVal === 'number') {
                return sortDir === 'asc' ? aVal - bVal : bVal - aVal;
            }
            return sortDir === 'asc' 
                ? String(aVal).localeCompare(String(bVal))
                : String(bVal).localeCompare(String(aVal));
        });
        
        // Re-append sorted cards
        visibleCards.forEach(card => albumsGrid.appendChild(card));
    }
    
    let debounceTimer;
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(filterAndSortAlbums, 200);
        });
    }
    
    if (sortFilter) {
        sortFilter.addEventListener('change', filterAndSortAlbums);
    }
});
</script>
{% endblock %}
