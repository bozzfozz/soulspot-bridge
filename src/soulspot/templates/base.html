<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SoulSpot{% endblock %}</title>
    <meta name="description" content="Intelligente Musik-Download-Anwendung">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SoulSpot">
    <link rel="apple-touch-icon" href="/static/icons/icon-192.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700;800&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Preload Critical Resources -->
    <link rel="preload" href="/static/css/layout.css" as="style">
    <link rel="preload" href="/static/css/components.css" as="style">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Design System -->
    <link rel="stylesheet" href="/static/css/layout.css">
    <link rel="stylesheet" href="/static/css/components.css">

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    {% block extra_head %}{% endblock %}
</head>

<body>
    <!-- Skip to Content (Accessibility) -->
    <a href="#main-content" class="skip-to-content">
        Skip to main content
    </a>
    
    <!-- Sidebar Navigation -->
    <nav class="app-sidebar" id="sidebar">
        <div class="sidebar-brand">
            <i class="fa-solid fa-bolt"></i>
            <span>SoulSpot</span>
        </div>

        <ul class="sidebar-nav">
            <li>
                <a href="/" class="nav-item {% if request.path == '/' %}active{% endif %}">
                    <i class="fa-solid fa-chart-pie"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li>
                <a href="/playlists" class="nav-item {% if 'playlists' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-music"></i>
                    <span>Playlists</span>
                </a>
            </li>
            <li>
                <a href="/library" class="nav-item {% if 'library' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-compact-disc"></i>
                    <span>Library</span>
                </a>
            </li>
            <li>
                <a href="/downloads" class="nav-item {% if 'downloads' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-download"></i>
                    <span>Downloads</span>
                </a>
            </li>
            <li>
                <a href="/settings" class="nav-item {% if 'settings' in request.path %}active{% endif %}">
                    <i class="fa-solid fa-gear"></i>
                    <span>Settings</span>
                </a>
            </li>
        </ul>

        <div class="sidebar-footer">
            <!-- Optional: User profile or status -->
        </div>
    </nav>

    <!-- Main Content -->
    <main class="app-main">
        <!-- Header -->
        <header class="app-header">
            <div class="header-search">
                <i class="fa-solid fa-search"></i>
                <input type="text" placeholder="Search tracks, artists..." 
                       name="q"
                       hx-get="/search/quick"
                       hx-trigger="keyup changed delay:500ms"
                       hx-target="#search-results"
                       autocomplete="off">
                <!-- Quick search results dropdown -->
                <div id="search-results" class="header-search-results"></div>
            </div>

            <div class="header-actions">
                <a href="/settings" class="btn btn-icon btn-secondary">
                    <i class="fa-regular fa-bell"></i>
                </a>
                <a href="/auth/logout" class="btn btn-icon btn-secondary" title="Logout">
                    <i class="fa-solid fa-right-from-bracket"></i>
                </a>
            </div>
        </header>

        <!-- Page Content -->
        <div id="main-content" class="page-content">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Scripts -->
    <script>
        // Service Worker Registration (PWA)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/service-worker.js')
                    .then((registration) => {
                        console.log('ServiceWorker registered:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New version available
                                    if (typeof ToastManager !== 'undefined') {
                                        ToastManager.info(
                                            'A new version is available. Refresh to update.',
                                            'Update Available',
                                            10000
                                        );
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error('ServiceWorker registration failed:', error);
                    });
            });
        }
        
        // Simple sidebar toggle for mobile (can be moved to external JS)
        document.addEventListener('DOMContentLoaded', () => {
            // Add any global JS initialization here
        });
    </script>
    <script src="/static/js/sse-client.js"></script>
    <script src="/static/js/circular-progress.js"></script>
    <script src="/static/js/fuzzy-search.js"></script>
    <script src="/static/js/notifications.js"></script>
    <script src="/static/js/mobile-gestures.js"></script>
    {% block extra_scripts %}{% endblock %}
</body>

</html>