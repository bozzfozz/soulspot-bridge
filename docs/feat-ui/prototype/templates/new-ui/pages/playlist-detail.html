{% extends "new-ui/base.html" %}

{% block title %}{{ playlist.name }} - SoulSpot{% endblock %}

{% block content %}
<!-- Playlist Header -->
<div class="card mb-8"
    style="background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%); padding: var(--space-8);">
    <div class="flex items-center gap-6">
        <img src="{{ playlist.cover_url or 'https://via.placeholder.com/200x200?text=' + playlist.name[0] }}"
            alt="{{ playlist.name }}"
            style="width: 200px; height: 200px; border-radius: var(--radius-lg); object-fit: cover; box-shadow: var(--shadow-xl);">
        <div style="flex: 1;">
            <div
                style="font-size: var(--font-size-xs); color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: var(--space-2);">
                Playlist
            </div>
            <h1 style="font-size: var(--font-size-4xl); margin-bottom: var(--space-2);">{{ playlist.name }}</h1>
            {% if playlist.description %}
            <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">{{ playlist.description }}</p>
            {% endif %}
            <div class="flex items-center gap-3 mb-6" style="font-size: var(--font-size-sm); color: var(--text-muted);">
                <span>{{ playlist.track_count or 0 }} tracks</span>
                <span>•</span>
                <span>{{ playlist.duration or '0h 0m' }}</span>
                <span>•</span>
                <span>{{ playlist.downloaded_count or 0 }} downloaded</span>
            </div>
            <div class="flex gap-3">
                <button class="btn btn-primary btn-lg" onclick="playPlaylist()">
                    <i class="fa-solid fa-play"></i>
                    Play
                </button>
                <button class="btn btn-outline btn-lg" onclick="downloadAll()">
                    <i class="fa-solid fa-download"></i>
                    Download All
                </button>
                <button class="btn btn-outline btn-lg" onclick="syncPlaylist()">
                    <i class="fa-solid fa-sync"></i>
                    Sync
                </button>
                <button class="btn-icon btn-lg" onclick="showMenu()">
                    <i class="fa-solid fa-ellipsis"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Tracks List -->
<div class="card" style="padding: 0;">
    {% if tracks %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 1px solid var(--border-primary);">
                <th style="padding: var(--space-3); text-align: left; width: 40px;">#</th>
                <th style="padding: var(--space-3); text-align: left;">Title</th>
                <th style="padding: var(--space-3); text-align: left;">Artist</th>
                <th style="padding: var(--space-3); text-align: left;">Album</th>
                <th style="padding: var(--space-3); text-align: left;">Added</th>
                <th style="padding: var(--space-3); text-align: left;">Duration</th>
                <th style="padding: var(--space-3); text-align: left;">Status</th>
                <th style="padding: var(--space-3); text-align: right;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for track in tracks %}
            <tr style="border-bottom: 1px solid var(--border-primary); transition: background-color var(--transition-fast);"
                onmouseover="this.style.backgroundColor='var(--bg-tertiary)'"
                onmouseout="this.style.backgroundColor='transparent'">
                <td style="padding: var(--space-3); color: var(--text-muted);">
                    {{ loop.index }}
                </td>
                <td style="padding: var(--space-3);">
                    <div class="flex items-center gap-3">
                        <img src="{{ track.album_art or 'https://via.placeholder.com/40x40' }}"
                            style="width: 40px; height: 40px; border-radius: var(--radius-sm); object-fit: cover;">
                        <div>
                            <div style="font-weight: var(--font-weight-medium);">{{ track.title }}</div>
                            {% if track.explicit %}
                            <span class="badge" style="margin-top: 0.25rem;">E</span>
                            {% endif %}
                        </div>
                    </div>
                </td>
                <td style="padding: var(--space-3);">
                    <a href="/library/artists/{{ track.artist_id }}"
                        style="color: var(--text-secondary); text-decoration: none;">
                        {{ track.artist }}
                    </a>
                </td>
                <td style="padding: var(--space-3);">
                    <a href="/library/albums/{{ track.album_id }}"
                        style="color: var(--text-secondary); text-decoration: none;">
                        {{ track.album }}
                    </a>
                </td>
                <td style="padding: var(--space-3); color: var(--text-muted); font-size: var(--font-size-sm);">
                    {{ track.added_at }}
                </td>
                <td style="padding: var(--space-3); color: var(--text-muted);">
                    {{ track.duration }}
                </td>
                <td style="padding: var(--space-3);">
                    {% if track.downloaded %}
                    <span class="badge badge-success">
                        <i class="fa-solid fa-check"></i>
                        Downloaded
                    </span>
                    {% elif track.downloading %}
                    <span class="badge badge-info">
                        <i class="fa-solid fa-spinner fa-spin"></i>
                        Downloading
                    </span>
                    {% elif track.pending %}
                    <span class="badge badge-warning">
                        <i class="fa-solid fa-clock"></i>
                        Pending
                    </span>
                    {% else %}
                    <span class="badge">
                        Not Downloaded
                    </span>
                    {% endif %}
                </td>
                <td style="padding: var(--space-3); text-align: right;">
                    <div class="flex gap-2" style="justify-content: flex-end;">
                        <button class="btn-icon" onclick="playTrack('{{ track.id }}')" title="Play">
                            <i class="fa-solid fa-play"></i>
                        </button>
                        {% if not track.downloaded %}
                        <button class="btn-icon" onclick="downloadTrack('{{ track.id }}')" title="Download">
                            <i class="fa-solid fa-download"></i>
                        </button>
                        {% endif %}
                        <button class="btn-icon" onclick="removeFromPlaylist('{{ track.id }}')" title="Remove">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="text-align: center; padding: 4rem;">
        <i class="fa-solid fa-music" style="font-size: 4rem; color: var(--text-muted); margin-bottom: 1.5rem;"></i>
        <h3>No Tracks in Playlist</h3>
        <p class="text-muted" style="margin-top: 0.5rem;">
            This playlist is empty. Sync with Spotify to add tracks.
        </p>
        <button class="btn btn-primary" style="margin-top: 1.5rem;" onclick="syncPlaylist()">
            <i class="fa-solid fa-sync"></i>
            Sync Now
        </button>
    </div>
    {% endif %}
</div>

{% endblock %}

{% block extra_scripts %}
<script>
    function playPlaylist() {
        console.log('Playing playlist');
        // TODO: Implement play functionality
    }

    function downloadAll() {
        if (confirm('Download all tracks in this playlist?')) {
            htmx.ajax('POST', '/api/playlists/{{ playlist.id }}/download', {
                target: 'body',
                swap: 'none'
            });
            SoulSpot.showNotification('Playlist added to download queue', 'success');
        }
    }

    function syncPlaylist() {
        htmx.ajax('POST', '/api/playlists/{{ playlist.id }}/sync', {
            target: 'body',
            swap: 'none'
        });
        SoulSpot.showNotification('Syncing playlist...', 'info');
    }

    function showMenu() {
        console.log('Show playlist menu');
        // TODO: Implement menu
    }

    function playTrack(trackId) {
        console.log('Playing track:', trackId);
    }

    function downloadTrack(trackId) {
        htmx.ajax('POST', `/api/tracks/${trackId}/download`, {
            target: 'body',
            swap: 'none'
        });
        SoulSpot.showNotification('Track added to download queue', 'success');
    }

    function removeFromPlaylist(trackId) {
        if (confirm('Remove this track from the playlist?')) {
            htmx.ajax('DELETE', `/api/playlists/{{ playlist.id }}/tracks/${trackId}`, {
                target: 'body',
                swap: 'none'
            });
        }
    }
</script>
{% endblock %}