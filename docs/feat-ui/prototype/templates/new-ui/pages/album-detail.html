{% extends "new-ui/base.html" %}

{% block title %}{{ album.name }} - SoulSpot{% endblock %}

{% block content %}
<!-- Album Header -->
<div class="card mb-8"
    style="background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%); padding: var(--space-8);">
    <div class="flex items-center gap-6">
        <img src="{{ album.cover_url or 'https://via.placeholder.com/200x200?text=' + album.name[0] }}"
            alt="{{ album.name }}"
            style="width: 200px; height: 200px; border-radius: var(--radius-lg); object-fit: cover; box-shadow: var(--shadow-xl);">
        <div style="flex: 1;">
            <div
                style="font-size: var(--font-size-xs); color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: var(--space-2);">
                Album
            </div>
            <h1 style="font-size: var(--font-size-4xl); margin-bottom: var(--space-2);">{{ album.name }}</h1>
            <a href="/library/artists/{{ album.artist_id }}"
                style="font-size: var(--font-size-xl); color: var(--text-primary); text-decoration: none; margin-bottom: var(--space-4); display: inline-block;">
                {{ album.artist }}
            </a>
            <div class="flex items-center gap-3 mb-6" style="font-size: var(--font-size-sm); color: var(--text-muted);">
                <span>{{ album.year or 'Unknown' }}</span>
                <span>•</span>
                <span>{{ album.track_count or 0 }} tracks</span>
                <span>•</span>
                <span>{{ album.duration or '0m' }}</span>
                {% if album.genre %}
                <span>•</span>
                <span>{{ album.genre }}</span>
                {% endif %}
            </div>
            <div class="flex gap-3">
                <button class="btn btn-primary btn-lg" onclick="playAlbum()">
                    <i class="fa-solid fa-play"></i>
                    Play
                </button>
                <button class="btn btn-outline btn-lg" onclick="downloadAlbum()">
                    <i class="fa-solid fa-download"></i>
                    Download Album
                </button>
                <button class="btn btn-outline btn-lg" onclick="addToPlaylist()">
                    <i class="fa-solid fa-plus"></i>
                    Add to Playlist
                </button>
                <button class="btn-icon btn-lg" onclick="showMenu()">
                    <i class="fa-solid fa-ellipsis"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Tracks List -->
<div class="card" style="padding: 0;">
    {% if tracks %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 1px solid var(--border-primary);">
                <th style="padding: var(--space-3); text-align: left; width: 40px;">#</th>
                <th style="padding: var(--space-3); text-align: left;">Title</th>
                <th style="padding: var(--space-3); text-align: left;">Duration</th>
                <th style="padding: var(--space-3); text-align: left;">Status</th>
                <th style="padding: var(--space-3); text-align: right;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for track in tracks %}
            <tr style="border-bottom: 1px solid var(--border-primary); transition: background-color var(--transition-fast);"
                onmouseover="this.style.backgroundColor='var(--bg-tertiary)'"
                onmouseout="this.style.backgroundColor='transparent'">
                <td style="padding: var(--space-3); color: var(--text-muted);">
                    {{ track.track_number or loop.index }}
                </td>
                <td style="padding: var(--space-3);">
                    <div>
                        <div style="font-weight: var(--font-weight-medium);">{{ track.title }}</div>
                        {% if track.explicit %}
                        <span class="badge" style="margin-top: 0.25rem;">E</span>
                        {% endif %}
                    </div>
                </td>
                <td style="padding: var(--space-3); color: var(--text-muted);">
                    {{ track.duration }}
                </td>
                <td style="padding: var(--space-3);">
                    {% if track.downloaded %}
                    <span class="badge badge-success">
                        <i class="fa-solid fa-check"></i>
                        Downloaded
                    </span>
                    {% elif track.downloading %}
                    <span class="badge badge-info">
                        <i class="fa-solid fa-spinner fa-spin"></i>
                        Downloading
                    </span>
                    {% elif track.pending %}
                    <span class="badge badge-warning">
                        <i class="fa-solid fa-clock"></i>
                        Pending
                    </span>
                    {% else %}
                    <span class="badge">
                        Not Downloaded
                    </span>
                    {% endif %}
                </td>
                <td style="padding: var(--space-3); text-align: right;">
                    <div class="flex gap-2" style="justify-content: flex-end;">
                        <button class="btn-icon" onclick="playTrack('{{ track.id }}')" title="Play">
                            <i class="fa-solid fa-play"></i>
                        </button>
                        {% if not track.downloaded %}
                        <button class="btn-icon" onclick="downloadTrack('{{ track.id }}')" title="Download">
                            <i class="fa-solid fa-download"></i>
                        </button>
                        {% endif %}
                        <button class="btn-icon" onclick="showTrackMenu('{{ track.id }}')" title="More">
                            <i class="fa-solid fa-ellipsis"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="text-align: center; padding: 4rem;">
        <i class="fa-solid fa-music" style="font-size: 4rem; color: var(--text-muted); margin-bottom: 1.5rem;"></i>
        <h3>No Tracks Found</h3>
        <p class="text-muted" style="margin-top: 0.5rem;">
            This album has no tracks yet.
        </p>
    </div>
    {% endif %}
</div>

<!-- Album Info -->
{% if album.description or album.label or album.total_tracks %}
<div class="card mt-8">
    <h2 class="mb-4">Album Information</h2>

    <div class="grid grid-cols-2 gap-6">
        <div>
            {% if album.description %}
            <div class="mb-4">
                <div style="font-size: var(--font-size-sm); color: var(--text-muted); margin-bottom: var(--space-1);">
                    Description</div>
                <p style="line-height: var(--line-height-relaxed);">{{ album.description }}</p>
            </div>
            {% endif %}

            {% if album.label %}
            <div class="mb-4">
                <div style="font-size: var(--font-size-sm); color: var(--text-muted); margin-bottom: var(--space-1);">
                    Label</div>
                <div>{{ album.label }}</div>
            </div>
            {% endif %}

            {% if album.release_date %}
            <div class="mb-4">
                <div style="font-size: var(--font-size-sm); color: var(--text-muted); margin-bottom: var(--space-1);">
                    Release Date</div>
                <div>{{ album.release_date }}</div>
            </div>
            {% endif %}
        </div>

        <div>
            {% if album.genres %}
            <div class="mb-4">
                <div style="font-size: var(--font-size-sm); color: var(--text-muted); margin-bottom: var(--space-1);">
                    Genres</div>
                <div class="flex gap-2">
                    {% for genre in album.genres %}
                    <span class="badge">{{ genre }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if album.spotify_url %}
            <div class="mb-4">
                <a href="{{ album.spotify_url }}" target="_blank" class="btn btn-outline"
                    style="width: 100%; justify-content: flex-start;">
                    <i class="fa-brands fa-spotify"></i>
                    Open in Spotify
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extra_scripts %}
<script>
    function playAlbum() {
        console.log('Playing album');
        // TODO: Implement play functionality
    }

    function downloadAlbum() {
        if (confirm('Download all tracks from this album?')) {
            htmx.ajax('POST', '/api/albums/{{ album.id }}/download', {
                target: 'body',
                swap: 'none'
            });
            SoulSpot.showNotification('Album added to download queue', 'success');
        }
    }

    function addToPlaylist() {
        console.log('Add to playlist');
        // TODO: Implement add to playlist modal
    }

    function showMenu() {
        console.log('Show album menu');
        // TODO: Implement menu
    }

    function playTrack(trackId) {
        console.log('Playing track:', trackId);
    }

    function downloadTrack(trackId) {
        htmx.ajax('POST', `/api/tracks/${trackId}/download`, {
            target: 'body',
            swap: 'none'
        });
        SoulSpot.showNotification('Track added to download queue', 'success');
    }

    function showTrackMenu(trackId) {
        console.log('Show track menu:', trackId);
    }
</script>
{% endblock %}