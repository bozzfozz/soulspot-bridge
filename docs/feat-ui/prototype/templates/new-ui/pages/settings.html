{% extends "new-ui/base.html" %}

{% block title %}Settings - SoulSpot{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="mb-8">
    <h1>Settings</h1>
    <p class="text-muted mt-2">Configure your SoulSpot experience</p>
</div>

<!-- Settings Layout -->
<div class="flex gap-6">
    <!-- Sidebar Navigation -->
    <div class="card" style="width: 240px; flex-shrink: 0; padding: var(--space-4);">
        <nav>
            <button class="settings-nav-item active" onclick="showSection('general')">
                <i class="fa-solid fa-cog"></i>
                General
            </button>
            <button class="settings-nav-item" onclick="showSection('spotify')">
                <i class="fa-brands fa-spotify"></i>
                Spotify
            </button>
            <button class="settings-nav-item" onclick="showSection('downloads')">
                <i class="fa-solid fa-download"></i>
                Downloads
            </button>
            <button class="settings-nav-item" onclick="showSection('library')">
                <i class="fa-solid fa-music"></i>
                Library
            </button>
            <button class="settings-nav-item" onclick="showSection('advanced')">
                <i class="fa-solid fa-sliders"></i>
                Advanced
            </button>
        </nav>
    </div>

    <!-- Settings Content -->
    <div style="flex: 1;">
        <!-- General Settings -->
        <div id="general-section" class="settings-section">
            <div class="card mb-6">
                <h2 class="mb-4">General Settings</h2>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Application Name</div>
                        <div class="setting-description">The name displayed in the application</div>
                    </div>
                    <input type="text" class="setting-input" value="SoulSpot" placeholder="SoulSpot">
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Theme</div>
                        <div class="setting-description">Choose your preferred theme</div>
                    </div>
                    <select class="setting-select">
                        <option value="dark" selected>Dark</option>
                        <option value="light">Light</option>
                        <option value="auto">Auto</option>
                    </select>
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Language</div>
                        <div class="setting-description">Select your language</div>
                    </div>
                    <select class="setting-select">
                        <option value="en">English</option>
                        <option value="de" selected>Deutsch</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Spotify Settings -->
        <div id="spotify-section" class="settings-section" style="display: none;">
            <div class="card mb-6">
                <h2 class="mb-4">Spotify Integration</h2>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Connection Status</div>
                        <div class="setting-description">Your Spotify account connection</div>
                    </div>
                    <div>
                        {% if spotify_connected %}
                        <span class="badge badge-success">
                            <i class="fa-solid fa-check"></i>
                            Connected
                        </span>
                        {% else %}
                        <span class="badge badge-error">
                            <i class="fa-solid fa-times"></i>
                            Not Connected
                        </span>
                        {% endif %}
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Spotify Account</div>
                        <div class="setting-description">Connect or disconnect your Spotify account</div>
                    </div>
                    {% if spotify_connected %}
                    <button class="btn btn-outline" onclick="disconnectSpotify()">
                        <i class="fa-solid fa-unlink"></i>
                        Disconnect
                    </button>
                    {% else %}
                    <a href="/auth" class="btn btn-primary">
                        <i class="fa-brands fa-spotify"></i>
                        Connect Spotify
                    </a>
                    {% endif %}
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Auto-Sync Playlists</div>
                        <div class="setting-description">Automatically sync playlists from Spotify</div>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Sync Interval</div>
                        <div class="setting-description">How often to sync playlists</div>
                    </div>
                    <select class="setting-select">
                        <option value="15">Every 15 minutes</option>
                        <option value="30" selected>Every 30 minutes</option>
                        <option value="60">Every hour</option>
                        <option value="0">Manual only</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Downloads Settings -->
        <div id="downloads-section" class="settings-section" style="display: none;">
            <div class="card mb-6">
                <h2 class="mb-4">Download Settings</h2>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Download Directory</div>
                        <div class="setting-description">Where to save downloaded music</div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" class="setting-input" value="/music/downloads"
                            placeholder="/path/to/downloads">
                        <button class="btn btn-outline">
                            <i class="fa-solid fa-folder"></i>
                            Browse
                        </button>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Concurrent Downloads</div>
                        <div class="setting-description">Maximum number of simultaneous downloads</div>
                    </div>
                    <select class="setting-select">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="5">5</option>
                    </select>
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Preferred Quality</div>
                        <div class="setting-description">Preferred audio quality for downloads</div>
                    </div>
                    <select class="setting-select">
                        <option value="320" selected>320 kbps (Best)</option>
                        <option value="256">256 kbps (High)</option>
                        <option value="192">192 kbps (Medium)</option>
                        <option value="128">128 kbps (Low)</option>
                    </select>
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Auto-Retry Failed</div>
                        <div class="setting-description">Automatically retry failed downloads</div>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Library Settings -->
        <div id="library-section" class="settings-section" style="display: none;">
            <div class="card mb-6">
                <h2 class="mb-4">Library Settings</h2>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Library Path</div>
                        <div class="setting-description">Path to your music library</div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" class="setting-input" value="/music/library" placeholder="/path/to/library">
                        <button class="btn btn-outline">
                            <i class="fa-solid fa-folder"></i>
                            Browse
                        </button>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Auto-Organize</div>
                        <div class="setting-description">Automatically organize files by artist/album</div>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Folder Structure</div>
                        <div class="setting-description">How to organize your music files</div>
                    </div>
                    <select class="setting-select">
                        <option value="artist-album" selected>Artist/Album</option>
                        <option value="artist-year-album">Artist/Year - Album</option>
                        <option value="flat">Flat (no folders)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Advanced Settings -->
        <div id="advanced-section" class="settings-section" style="display: none;">
            <div class="card mb-6">
                <h2 class="mb-4">Advanced Settings</h2>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">API Port</div>
                        <div class="setting-description">Port for the API server</div>
                    </div>
                    <input type="number" class="setting-input" value="8000" placeholder="8000">
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Debug Mode</div>
                        <div class="setting-description">Enable debug logging</div>
                    </div>
                    <label class="toggle">
                        <input type="checkbox">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-title">Clear Cache</div>
                        <div class="setting-description">Clear application cache and temporary files</div>
                    </div>
                    <button class="btn btn-outline" onclick="clearCache()">
                        <i class="fa-solid fa-trash"></i>
                        Clear Cache
                    </button>
                </div>
            </div>
        </div>

        <!-- Save Button -->
        <div class="flex justify-end gap-3">
            <button class="btn btn-outline">
                Reset to Defaults
            </button>
            <button class="btn btn-primary">
                <i class="fa-solid fa-save"></i>
                Save Changes
            </button>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
    function showSection(section) {
        // Hide all sections
        document.querySelectorAll('.settings-section').forEach(s => s.style.display = 'none');

        // Remove active class from all nav items
        document.querySelectorAll('.settings-nav-item').forEach(item => item.classList.remove('active'));

        // Show selected section
        document.getElementById(section + '-section').style.display = 'block';

        // Add active class to clicked nav item
        event.target.classList.add('active');
    }

    function disconnectSpotify() {
        if (confirm('Are you sure you want to disconnect your Spotify account?')) {
            htmx.ajax('POST', '/api/auth/disconnect', { target: 'body', swap: 'none' });
        }
    }

    function clearCache() {
        if (confirm('Are you sure you want to clear the cache?')) {
            htmx.ajax('POST', '/api/system/clear-cache', { target: 'body', swap: 'none' });
            SoulSpot.showNotification('Cache cleared successfully', 'success');
        }
    }
</script>

<style>
    .settings-nav-item {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        width: 100%;
        padding: var(--space-3);
        background: transparent;
        border: none;
        border-radius: var(--radius-md);
        color: var(--text-secondary);
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
        text-align: left;
        cursor: pointer;
        transition: all var(--transition-fast);
        margin-bottom: var(--space-1);
    }

    .settings-nav-item:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
    }

    .settings-nav-item.active {
        background: var(--accent-subtle);
        color: var(--accent-primary);
    }

    .setting-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-4) 0;
        border-bottom: 1px solid var(--border-primary);
    }

    .setting-item:last-child {
        border-bottom: none;
    }

    .setting-label {
        flex: 1;
        margin-right: var(--space-4);
    }

    .setting-title {
        font-weight: var(--font-weight-medium);
        color: var(--text-primary);
        margin-bottom: var(--space-1);
    }

    .setting-description {
        font-size: var(--font-size-sm);
        color: var(--text-muted);
    }

    .setting-input,
    .setting-select {
        width: 300px;
        padding: var(--space-2) var(--space-3);
        background: var(--bg-tertiary);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-size: var(--font-size-sm);
    }

    .setting-input:focus,
    .setting-select:focus {
        outline: none;
        border-color: var(--accent-primary);
    }

    /* Toggle Switch */
    .toggle {
        position: relative;
        display: inline-block;
        width: 48px;
        height: 24px;
    }

    .toggle input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--bg-tertiary);
        transition: var(--transition-normal);
        border-radius: var(--radius-full);
    }

    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: var(--transition-normal);
        border-radius: 50%;
    }

    .toggle input:checked+.toggle-slider {
        background-color: var(--accent-primary);
    }

    .toggle input:checked+.toggle-slider:before {
        transform: translateX(24px);
    }
</style>
{% endblock %}