{% extends "new-ui/base.html" %}

{% block title %}Albums - SoulSpot{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="flex items-center justify-between mb-8">
    <div>
        <h1>Albums</h1>
        <p class="text-muted mt-2">Browse and manage your album collection</p>
    </div>
    <div class="flex gap-3">
        <button class="btn btn-outline">
            <i class="fa-solid fa-filter"></i>
            Filters
        </button>
        <button class="btn btn-outline">
            <i class="fa-solid fa-sort"></i>
            Sort
        </button>
    </div>
</div>

<!-- Stats -->
<div class="grid grid-cols-4 mb-8">
    <div class="stat-card">
        <div class="stat-card-icon">
            <i class="fa-solid fa-compact-disc"></i>
        </div>
        <div class="stat-card-content">
            <div class="stat-card-label">Total Albums</div>
            <div class="stat-card-value">{{ albums|length or 0 }}</div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-card-icon">
            <i class="fa-solid fa-music"></i>
        </div>
        <div class="stat-card-content">
            <div class="stat-card-label">Total Tracks</div>
            <div class="stat-card-value">{{ total_tracks or 0 }}</div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-card-icon">
            <i class="fa-solid fa-check-circle"></i>
        </div>
        <div class="stat-card-content">
            <div class="stat-card-label">Downloaded</div>
            <div class="stat-card-value">{{ downloaded_count or 0 }}</div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-card-icon">
            <i class="fa-solid fa-calendar"></i>
        </div>
        <div class="stat-card-content">
            <div class="stat-card-label">This Year</div>
            <div class="stat-card-value">{{ this_year_count or 0 }}</div>
        </div>
    </div>
</div>

<!-- Search Bar -->
<div class="card mb-6" style="padding: var(--space-4);">
    <div class="flex items-center gap-3">
        <i class="fa-solid fa-search" style="color: var(--text-muted);"></i>
        <input type="text" placeholder="Search albums..."
            style="flex: 1; background: transparent; border: none; outline: none; color: var(--text-primary); font-size: var(--font-size-base);"
            hx-get="/api/library/albums/search" hx-trigger="keyup changed delay:300ms" hx-target="#albums-grid">
    </div>
</div>

<!-- Albums Grid -->
<div id="albums-grid">
    {% if albums %}
    <div class="grid grid-cols-6">
        {% for album in albums %}
        <a href="/library/albums/{{ album.id }}" class="media-card">
            <div class="media-card-image">
                <img src="{{ album.cover_url or 'https://via.placeholder.com/300x300?text=' + album.name[0] }}"
                    alt="{{ album.name }}">
                <div class="media-card-overlay">
                    <div class="media-card-actions">
                        <button class="btn-icon btn-primary"
                            onclick="event.preventDefault(); playAlbum('{{ album.id }}')">
                            <i class="fa-solid fa-play"></i>
                        </button>
                        <button class="btn-icon" onclick="event.preventDefault(); downloadAlbum('{{ album.id }}')">
                            <i class="fa-solid fa-download"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="media-card-content">
                <div class="media-card-title">{{ album.name }}</div>
                <div class="media-card-subtitle">{{ album.artist }}</div>
                <div class="media-card-meta">
                    <span>{{ album.year or 'Unknown' }}</span>
                    <span>â€¢</span>
                    <span>{{ album.track_count or 0 }} tracks</span>
                </div>
                {% if album.downloaded %}
                <div class="media-card-meta" style="margin-top: var(--space-2);">
                    <span class="badge badge-success">
                        <i class="fa-solid fa-check"></i>
                        Downloaded
                    </span>
                </div>
                {% endif %}
            </div>
        </a>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="flex items-center justify-center gap-2 mt-8">
        {% if page > 1 %}
        <a href="?page={{ page - 1 }}" class="btn btn-outline btn-sm">
            <i class="fa-solid fa-chevron-left"></i>
        </a>
        {% endif %}

        <span class="text-muted">Page {{ page }} of {{ total_pages }}</span>

        {% if page < total_pages %} <a href="?page={{ page + 1 }}" class="btn btn-outline btn-sm">
            <i class="fa-solid fa-chevron-right"></i>
            </a>
            {% endif %}
    </div>
    {% endif %}

    {% else %}
    <!-- Empty State -->
    <div class="card" style="text-align: center; padding: 4rem;">
        <i class="fa-solid fa-compact-disc"
            style="font-size: 4rem; color: var(--text-muted); margin-bottom: 1.5rem;"></i>
        <h2>No Albums Yet</h2>
        <p class="text-muted" style="margin-top: 0.5rem; margin-bottom: 2rem;">
            Start by importing playlists from Spotify or adding albums manually.
        </p>
        <a href="/playlists/import" class="btn btn-primary">
            <i class="fa-solid fa-download"></i>
            Import from Spotify
        </a>
    </div>
    {% endif %}
</div>

{% endblock %}

{% block extra_scripts %}
<script>
    function playAlbum(albumId) {
        console.log('Playing album:', albumId);
        // TODO: Implement play functionality
    }

    function downloadAlbum(albumId) {
        console.log('Downloading album:', albumId);
        htmx.ajax('POST', `/api/albums/${albumId}/download`, {
            target: 'body',
            swap: 'none'
        });
        SoulSpot.showNotification('Album added to download queue', 'success');
    }
</script>
{% endblock %}