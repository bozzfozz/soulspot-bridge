services:
  # SoulSpot - Main application (local single-user setup)
  # Note: Most configuration uses internal defaults from settings.py and Dockerfile
  # Only external service credentials and container-specific settings are configured here
  soulspot:
    # Use pre-built image from GitHub Container Registry
    # For local development, uncomment the build section below and comment out the image line
    image: ghcr.io/bozzfozz/soulspot:latest
    # build:
    #   context: ..
    #   dockerfile: docker/Dockerfile
    #   args:
    #     # Optional: Build from a specific Git branch instead of local files
    #     # GIT_BRANCH: main
    #     # GIT_REPO: https://github.com/bozzfozz/soulspot.git
    container_name: soulspot
    ports:
      - "8765:8765"      # Web UI and API
    volumes:
      - ./mnt/downloads:/downloads
      - ./mnt/music:/music
      - ./mnt/soulspot:/config
    environment:
      # User and Permissions
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - UMASK=${UMASK:-002}
      - TZ=${TZ:-Europe/Berlin}
      
      # Spotify Configuration (Required)
      - SPOTIFY_CLIENT_ID=${SPOTIFY_CLIENT_ID:-}
      - SPOTIFY_CLIENT_SECRET=${SPOTIFY_CLIENT_SECRET:-}
      - SPOTIFY_REDIRECT_URI=${SPOTIFY_REDIRECT_URI:-http://127.0.0.1:8765/api/auth/callback}
      
      # slskd Configuration (Required)
      - SLSKD_URL=${SLSKD_URL:-http://host.docker.internal:5030}
      # Authentication: Use API key (recommended) OR username/password (fallback)
      - SLSKD_API_KEY=${SLSKD_API_KEY:-}
      - SLSKD_USERNAME=${SLSKD_USERNAME:-admin}
      # WARNING: You MUST set SLSKD_PASSWORD to a strong value in production!
      - SLSKD_PASSWORD=${SLSKD_PASSWORD:-}
      
      # Database (Container path)
      - DATABASE_URL=sqlite+aiosqlite:///config/soulspot.db
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8765/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - soulspot-network

networks:
  soulspot-network:
    driver: bridge
